<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <title>ポケモンユナイトダメージ計算</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <link rel="stylesheet" href="stylesheet.css">
  </head>
  <body>
    <div class = "attack" id="attack">
      <p class="cut">攻撃側</p>
      <br>
      <div class="attackpokemon">
      <label>攻撃側のポケモン
      <input list="atkpokemon" id="attackpokemon"  value="ルカリオ" placeholder="ポケモン名">
      </label>
      </div>
      <datalist id="atkpokemon">
        <option value="ルカリオ">
        <option value="ピカチュウ">
        <option value="アローラキュウコン">
      </datalist>
        <datalist id="defpokemon">
        <option value="ルカリオ">
        <option value="ピカチュウ">
        <option value="アローラキュウコン">
        <option value="みがわり人形">
      </datalist>
      <div class="skill">
      <label>技名
      <input list="skills" value="しんそく" id="skill" placeholder="技名">
      </label>
      </div>
      <div id="datalists">
        <datalist id="skills">
          <option value="通常攻撃">通常攻撃</option>
          <option value="強化攻撃">強化攻撃</option>
          <option value="でんこうせっか">でんこうせっか</option>
          <option value="しんそく">しんそく</option>
          <option value="しんそく+">しんそく+</option>
          <option value="しんそくの回し蹴り">しんそくの回し蹴り</option>
          <option value="チャージなしグロウパンチ">チャージなしグロウパンチ</option>
          <option value="フルチャージグロウパンチ">フルチャージグロウパンチ</option>
          <option value="コメットパンチ">コメットパンチ</option>
          <option value="ボーンラッシュ(4-7ヒット)">ボーンラッシュ</option>
          <option value="インファイト(11ヒット)">インファイト</option>
          <option value="インファイト+(11ヒット)">インファイト+</option>
          <option value="ユナイトわざ(4ヒット)">ユナイトわざ</option>
        </datalist>
        <datalist id="allitems">
          <option value="ちからのハチマキ">ちからのハチマキ</option>
          <option value="かるいし">かるいし</option>
          <option value="もうこうダンベル">もうこうダンベル</option>
          <option value="するどいツメ">するどいツメ</option>
          <option value="じゃくてんほけん">じゃくてんほけん</option>
          <option value="ピントレンズ">ピントレンズ</option>
          <option value="しんげきメガネ">しんげきメガネ</option>
          <option value="エオスビスケット">エオスビスケット</option>
          <option value="ものしりメガネ">ものしりメガネ</option>
          <option value="こだわりメガネ">こだわりメガネ</option>
          <option value="エナジーアンプ">エナジーアンプ</option>
          <option value="とつげきチョッキ">とつげきチョッキ</option>
          <option value="おたすけバリア">おたすけバリア</option>
          <option value="がくしゅうそうち">がくしゅうそうち</option>
          <option value="きあいのハチマキ">きあいのハチマキ</option>
          <option value="たべのこし">たべのこし</option>
          <option value="ゴツゴツメット">ゴツゴツメット</option>
          <option value="ゴールサポーター">ゴールサポーター</option>
          <option value="かいがらのすず">かいがらのすず</option>
        </datalist>
      </div>
      <div class="atklevel">
      <label>レベル
      <input type="number" min="1" max="15" value="1" id="attacklevel" placeholder="レベル">
      </label>
      </div>
        <div class="item">
          <label>もちもの</label>
          <ul>
            <li name="itemli"><input name = "item" placeholder="もちもの" class="items" list="allitems" value="ちからのハチマキ"><label>レベル</label><input type="number" min="1" max="30" class="item_level" value="20" placeholder="レベ"><br><label>CT0秒</label><input type="checkbox" checked id="atkpowerband"></li>
            <li name="itemli"><input name = "item" placeholder="もちもの" class="items" list="allitems"value="かるいし"><label>レベル</label><input type="number" min="1" max="30" class="item_level" value="20" placeholder="レベ"><br><label>備考欄</label><label id="atkfloatstone"></label></li>
            <li name="itemli"><input name = "item" placeholder="もちもの" class="items" list="allitems" value="もうこうダンベル"><label>レベル</label><input type="number" min="1" max="30" class="item_level" value="20" placeholder="レべ"><br><label>筋トレ回数</label><input type="number" min = "0" max="6" value="0" placeholder="回数" id="atkdumbbell"></li>
          </ul>
          <p id="warning" class="warning"></p>
        </div>
      <br>
      <div id="checks">
        <label class="check">
         急所
         <input type="checkbox" id="critical"/>
        </label>
        <label class="check">
          プラスパワー
          <input type="checkbox" id="pluspower"/>
        </label>
        <br>
      </div>
      <p id="atk" class="stats">attack:160</p>
    </div>
    <div class="defence">
      <p class="cut">防御側</p>
      <br>
      <div class="defencepokemon">
        <label>防御側のポケモン
        <input list="defpokemon" id="defencepokemon" value="ルカリオ" placeholder="ポケモン名">
        </label>
      </div>
      <br>
      <div class="deflevel">
        <label>レベル
        <input type="number" min="1" max="15" value="1" id="defencelevel" placeholder="レベル">
        </label>
      </div>
      <p id="maxhp" class="stats">最大HP:3250</p>
      <div class="nowhp">
        <label>残りHP:</label>
        <input type="number" min="0" max="3250" id="nowhp" placeholder="残りHP" class="num" value="3250">
        <input type="button" value="3250" class="btn" id="nowhp_btn">
      </div>
      <p id="def" class="stats">ぼうぎょ:78</p>
      <div class="item">
        <label>もちもの</label>
        <ul>
          <li name="itemli"><input name = "item" placeholder="もちもの" class="items" value="ちからのハチマキ"><label>レベル</label><input type="number" min="1" max="30" class="item_level" value="20" placeholder="レベ"><br><label>CT0秒</label><input type="checkbox" checked id="defpowerband"></li>
          <li name="itemli"><input name = "item" placeholder="もちもの" class="items" value="かるいし"><label>レベル</label><input type="number" min="1" max="30" class="item_level" value="20" placeholder="レベ"><br><label>備考欄</label><label id="deffloatstone"></label></li>
          <li name="itemli"><input name = "item" placeholder="もちもの" class="items" value="もうこうダンベル"><label>レベル</label><input type="number" min="1" max="30" class="item_level" value="20" placeholder="レべ"><br><label>筋トレ回数</label><input type="number" min = "0" max="6" value="0" placeholder="回数" id="defdumbbell"></li>
        </ul>
        <p id="warning2" class="warning"></p>
      </div>
    </div>
    <p id="result" class="result"></p>
    <p id="memo"></p>
    <a href="https://unite-db.com" class="unitedb" >データを確認するのに利用したUniteDB様</a>
    <script>
      //起こった行-この2つ上の行がえらーで報告されるっぽい
      //arrayは参照する配列 dataは探す文字列　lengthはそのまんま　 arrayの1番最初の要素がdataの要素を返す関数
    function extract(array,data,length){
        let result = "";
        for(let i = 0;i<length;i++){
          if(array[i][Object.keys(array[i])[0]] === data){
          result = array[i];
         }
        }
        if(result === ""){
          result = "見つかりませんでした。";
        }
        return result;
      } 
      function fill(value,number){
        let array = [];
        for(let i = 1;i<=number;i++){
          array.push(value);
        }
        return array;
      }
      class Pokemon{
        constructor(name,hp,attack,defence,sp_attack,sp_defence,kind,skills){
          this.name = name;
          this.hp= hp;
          this.attack = attack;
          this.defence = defence;
          this.sp_attack = sp_attack;
          this.sp_defence = sp_defence;
          this.kind = kind;
          this.skills = skills;
        }
      }
      class Skill{
        constructor(name,ratio,per=0,base=0,rate=[0,0],decrease=[0,0],current=[0,0]){
          this.name = name;
          this.ratio = ratio;
          this.per = per;
          this.base = base;
          this.rate = rate;//最大割合
          this.decrease = decrease;//減少割合
          this.current = current;//現在hp割合
        }
      }
      let data = [new Pokemon("ルカリオ",[3250,3392,3549,3721,3910,4118,4347,4599,4877,5184,5522,5894,6303,6753,7249],[160,170,180,192,205,219,234,251,270,291,314,339,366,396,429],[78,89,101,114,129,145,163,183,205,229,255,284,316,351,390],[20,23,27,31,36,41,46,52,59,66,74,83,93,104,116],[60,69,78,88,99,112,126,141,158,176,196,218,243,270,300],"attack",[new Skill("しんそく",198,6,270),new Skill("しんそく+",198,6,270),new Skill("フルチャージグロウパンチ",381.8,5,161,[0,0],[10,1000]),new Skill("チャージなしグロウパンチ",209.15,3,88,10,[0,0],[10,1000]),new Skill("通常攻撃",100),new Skill("強化攻撃",130),new Skill("でんこうせっか",221,11,240),new Skill("しんそくの回し蹴り",75),new Skill("コメットパンチ",167,8,180),new Skill("ボーンラッシュ(4-7ヒット)",41,1,50),new Skill("インファイト(11ヒット)",50,2,60),new Skill("インファイト+(11ヒット)",56,2,69),new Skill("ユナイトわざ(4ヒット)",174,4,210)])];
      data.push(new Pokemon("みがわり人形",fill(100000,15),fill(0,15),fill(0,15),fill(0,15),fill(0,15),"attack",null));
      data.push(new Pokemon("ピカチュウ",[3292,3399,3517,3646,3788,3945,4117,4307,4516,4747,5001,5280,5588,5927,6300],[134,140,146,153,160,168,177,187,198,210,223,237,253,271,290],[35,40,45,51,58,65,73,82,92,103,115,128,142,158,175],[50,82,117,156,199,246,298,355,418,487,563,647,740,842,954],[27,31,35,40,45,51,57,64,72,80,89,99,110,122,135],"special",[new Skill("通常攻撃",100),new Skill("強化攻撃",38,10,200),new Skill("でんきショック",75,21,390),new Skill("エレキボール",66,25,530,[0,0],[4,999999]),new Skill("エレキボール+",77,29,640,[0,0],[5,999999]),new Skill("かみなり(5,+7ヒット)",20,5,210),new Skill("エレキネット",36,11,350),new Skill("ボルテッカー(5ヒット)",14,3,140),new Skill("10まんボルト",50,12,500),new Skill("10まんボルト+",61,12,609),new Skill("ユナイト技(4ヒット)",49,10,490)]));
      data.push(new Pokemon("アローラキュウコン",[3197,3266,3345,3747,3852,3972,4110,4269,4452,4663,4906,5185,5506,5875,6299],[134,137,141,161,166,172,179,187,196,207,219,233,249,268,289],[35,38,42,60,65,70,76,83,91,101,112,125,139,156,175],[51,72,96,219,251,288,330,379,435,500,574,660,759,872,1002],[27,29,32,46,50,54,59,65,71,78,86,96,107,120,135],"special",[new Skill("通常攻撃",100),new Skill("強化攻撃",56,14,260),new Skill("こなゆき",78,13,240),new Skill("ゆきなだれ(2ヒット)",36,8,190),new Skill("マジカルシャイン",60,10,320),new Skill("マジカルシャイン+",61,10,380),new Skill("こごえるかぜ(2ヒット)",61,7,240),new Skill("ふぶき(1段目)",39,4,250),new Skill("ふぶき(エリア6ヒット)",19.5,2,125),new Skill("ふぶき+(1段目)",42.8,4,280),new Skill("ふぶき+(エリア6ヒット)",21.4,2,140),new Skill("ユナイト技(対象が氷)",224,32,1520),new Skill("ユナイト技(対象が氷でない)",158.6,30,1064)]));

      console.log(data);
      let inputattackpokemon=document.getElementById("attackpokemon");
      let inputskill = document.getElementById("skill");
      let inputattacklevel = document.getElementById("attacklevel");
      let attackpokemon = extract(data,inputattackpokemon.value,data.length); //名前じゃなくてdata内のオブジェクト
      let skill = extract(attackpokemon.skills,inputskill.value,attackpokemon.skills.length);
      let attacklevel = inputattacklevel.value - 0;
      let attack = attackpokemon.attack[attacklevel-1];
      let sp_attack = attackpokemon.sp_attack[attacklevel-1];
      let kind =  attackpokemon.kind;//ポケモンが物理か特殊か
      let atk = document.getElementById("atk");//htmlの要素
      let maxhp = document.getElementById("maxhp");
      let inputnowhp = document.getElementById("nowhp");
      let def = document.getElementById("def");
      let nowhp = inputnowhp.value;
      let btnnowhp = document.getElementById("nowhp_btn");
      let check = document.getElementById("check");//チェックボックス
      let judg = false;//技がプラスになっているかどうか
      let inputdefencepokemon = document.getElementById("defencepokemon");
      let inputdefencelevel = document.getElementById("defencelevel");
      let defencelevel = inputdefencelevel.value;
      let defencepokemon = extract(data,inputdefencepokemon.value,data.length);
      let healthpoint = defencepokemon.hp[defencelevel-1];
      let defence = defencepokemon.defence[defencelevel-1];
      let sp_defence = defencepokemon.sp_defence[defencelevel-1];
      let damage = 0;//ダメージ
      let makizoe = document.getElementById("makizoe");//checkboxのlabel
      let lucario_extremespeedbuff = false;
      let memo = document.getElementById("memo");
      let extremespeedbuff_check = null;
      let inputitems =document.getElementsByName("item");
      let items =[inputitems[0].value,inputitems[1].value,inputitems[2].value,inputitems[3].value,inputitems[4].value,inputitems[5].value];
      let inputitems_level = document.getElementsByClassName("item_level");
      let items_level =[inputitems_level[0],inputitems_level[1],inputitems_level[2],inputitems_level[3],inputitems_level[4],inputitems_level[5]];
      let inputcritical = document.getElementById("critical");
      let inputpluspower = document.getElementById("pluspower");
      function write(text){
        memo.textContent = memo.textContent+text+",";
      }
      function powerband(i,kind,itemlv){
        if(document.getElementById(kind+"powerband")===null){
          let frag = document.createElement("label");
          let node = document.createElement("input");
          node.type="checkbox";
          node.checked =true;
          node.id=kind+"powerband";
          frag.appendChild(document.createTextNode("CT0秒"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"powerband").addEventListener("change",calculation);
         }
        if(kind==="atk"){
          attack+=Math.floor((itemlv-0+1)/2);
        }
      }
      function floatstone(i,kind,itemlv){
        if(document.getElementById(kind+"floatstone")===null){
          let frag = document.createElement("label");
          let node = document.createElement("label");
          node.id=kind+"floatstone";
          frag.appendChild(document.createTextNode("備考欄"));
        }
        if(kind==="atk"){
          attack+=1.6*Math.floor((itemlv-0+1)/2);
        }
      }
      function dumbbell(i,kind,itemlv){
        if(document.getElementById(kind+"dumbbell")===null){
          let frag = document.createElement("label");
          let node = document.createElement("input");
          node.type="number";
          node.min = "0";
          node.max = "6";
          node.value = "0";
          node.id = kind+"dumbbell";
          node.placeholder = "回数"
          frag.appendChild(document.createTextNode("筋トレ回数"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"dumbbell").addEventListener("change",calculation);
        }
        if(kind==="atk"){
          attack+=0.6*itemlv+[6,9,12,12][Math.floor(itemlv/10)]*document.getElementById("atkdumbbell").value;
        }
      }
      function nail(i,kind,itemlv){
        if(document.getElementById(kind+"nail")===null){
          let frag = document.createElement("label");
          let node = document.createElement("input");
          node.type="checkbox";
          node.checked = true;
          node.id=kind+"nail";
          frag.appendChild(document.createTextNode("発動中"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"nail").addEventListener("change",calculation);
        }
        if(kind==="atk"){
          attack+=Math.floor((itemlv-0+1)/2);
        }
      }
      function insurance(i,kind,itemlv){
        if(document.getElementById(kind+"insurance")===null){
          let frag = document.createElement("label");
          let node = document.createElement("input");
          node.type="number";
          node.min = "0";
          node.max = "4";
          node.value="0";
          node.id = kind+"insurance";
          node.placeholder="回数";
          frag.appendChild(document.createTextNode("スタック数"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"insurance").addEventListener("change",calculation);
        }
        if(kind==="atk"){
          attack+=Math.floor((itemlv-0)/2);
        }else{
          nowhp+=Math.floor((itemlv-0-1)/2)*10+70;
          healthpoint+=Math.floor((itemlv-0-1)/2)*10+70;
          btnnowhp.value = healthpoint;
          inputnowhp.max = healthpoint;
        }
      }
      function scope(i,kind,itemlv){
        if(document.getElementById(kind+"scope")===null){
          let frag = document.createElement("label");
          let node = document.createElement("input");
          node.type="checkbox";
          node.chekced = true;
          node.id=kind+"scope"
          frag.appendChild(document.createTextNode("CT0秒"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"scope").addEventListener("change",calculation);
        }
      }
      function specs(i,kind,itemlv){
        if(document.getElementById(kind+"specs")===null){
          let frag = document.createElement("label");
          let node = document.createElement("input");
          node.type="number";
          node.min = "0";
          node.max = "6";
          node.value = "0";
          node.id = kind+"specs";
          node.placeholder = "回数"
          frag.appendChild(document.createTextNode("筋トレ回数"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"specs").addEventListener("change",calculation);
        }
        if(kind==="atk"){
          sp_attack+=0.8*itemlv+[8,12,16,16][Math.floor(itemlv/10)]*document.getElementById("atkspecs").value;
        }
      }
      function cookie(i,kind,itemlv){
        if(document.getElementById(kind+"cookie")===null){
          let frag = document.createElement("label");
          let node = document.createElement("input");
          node.type="number";
          node.min = "0";
          node.max = "6";
          node.value = "0";
          node.id = kind+"cookie";
          node.placeholder = "回数"
          frag.appendChild(document.createTextNode("筋トレ回数"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"cookie").addEventListener("change",calculation);
        }
        if(kind==="def"){
          nowhp+=8*itemlv+[100,150,200,200][Math.floor(itemlv/10)]*document.getElementById("defcookie").value
          healthpoint+=8*itemlv+[100,150,200,200][Math.floor(itemlv/10)]*document.getElementById("defcookie").value
          btnnowhp.value = healthpoint;
          inputnowhp.max = healthpoint;
        }
      }
      function wise(i,kind,itemlv){
        if(document.getElementById(kind+"wise")===null){
          let frag = document.createElement("label");
          let node = document.createElement("label");
          node.appendChild(document.createTextNode("備考欄"));
          node.id =kind+"wise";
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"wise").addEventListener("change",calculation);
        }
        if(kind==="atk"){
          sp_attack+=9+itemlv;
        }
      }
      function choice(i,kind,itemlv){
        if(document.getElementById(kind+"choice")===null){
          let frag = document.createElement("label");
          let node = document.createElement("input");
          node.type="checkbox";
          node.chekced = true;
          node.id=kind+"choice"
          frag.appendChild(document.createTextNode("CT0秒"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"choice").addEventListener("change",calculation);
        }
        if(kind==="atk"){
          sp_attack+=9+itemlv;
        }
      }
      function energy(i,kind,itemlv){
        if(document.getElementById(kind+"energy")===null){
          let frag = document.createElement("label");
          let node = document.createElement("input");
          node.type="checkbox";
          node.chekced = true;
          node.id=kind+"energy"
          frag.appendChild(document.createTextNode("発動中"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"energy").addEventListener("change",calculation);
        }
      }
      function vest(i,kind,itemlv){
        if(document.getElementById(kind+"vest")===null){
          let frag = document.createElement("label");
          let node = document.createElement("label");
          node.id=kind+"vest";
          frag.appendChild(document.createTextNode("備考欄"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"vest").addEventListener("change",calculation);
        }
        if(kind==="def"){
          nowhp+=18*Math.floor((itemlv+1)/2);
          healthpoint+=18*Math.floor((itemlv+1)/2);
          btnnowhp.value = healthpoint;
          inputnowhp.max = healthpoint;
          sp_defence+=2.8*Math.floor(itemlv/2);
        }
      }
      function barrier(i,kind,itemlv){
        if(document.getElementById(kind+"barrier")===null){
          let frag = document.createElement("label");
          let node = document.createElement("label");
          node.id=kind+"barrier";
          frag.appendChild(document.createTextNode("備考欄"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"barrier").addEventListener("change",calculation);
        }
        if(kind==="def"){
          nowhp+=15*itemlv;
          healthpoint+=15*itemlv;
          btnnowhp.value = healthpoint;
          inputnowhp.max = healthpoint;
        }
      }
      function share(i,kind,itemlv){
        if(document.getElementById(kind+"share")===null){
          let frag = document.createElement("label");
          let node = document.createElement("label");
          node.id=kind+"share";
          frag.appendChild(document.createTextNode("備考欄"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"share").addEventListener("change",calculation);
        }
        if(kind==="def"){
          nowhp+=16*Math.floor((itemlv+1)/2);
          healthpoint+=16*Math.floor((itemlv+1)/2);
          btnnowhp.value = healthpoint;
          inputnowhp.max = healthpoint;
        }
      }
      function focusband(i,kind,itemlv){
        if(document.getElementById(kind+"focusband")===null){
          let frag = document.createElement("label");
          let node = document.createElement("label");
          node.id=kind+"focusband";
          frag.appendChild(document.createTextNode("備考欄"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"focusband").addEventListener("change",calculation);
        }
        if(kind==="def"){
          defence+=2*Math.floor((itemlv+1)/2);
          defence+=2*Math.floor(itemlv/2);
        }
      }
      function leftovers(i,kind,itemlv){
        if(document.getElementById(kind+"leftovers")===null){
          let frag = document.createElement("label");
          let node = document.createElement("label");
          node.id=kind+"leftobers";
          frag.appendChild(document.createTextNode("備考欄"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"leftovers").addEventListener("change",calculation);
        }
        if(kind==="def"){
          nowhp+=16*Math.floor((itemlv+1)/2);
          healthpoint+=16*Math.floor((itemlv+1)/2);
          btnnowhp.value = healthpoint;
          inputnowhp.max = healthpoint;
        }
      }
      function helmet(i,kind,itemlv){
        if(document.getElementById(kind+"helmet")===null){
          let frag = document.createElement("label");
          let node = document.createElement("label");
          node.id=kind+"helmet";
          frag.appendChild(document.createTextNode("備考欄"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"helmet").addEventListener("change",calculation);
        }
        if(kind==="def"){
          nowhp+=18*Math.floor((itemlv+1)/2);
          healthpoint+=18*Math.floor((itemlv+1)/2);
          btnnowhp.value = healthpoint;
          inputnowhp.max = healthpoint;
          defence+=2.8*Math.floor(itemlv/2);
        }
      }
      function scoreshield(i,kind,itemlv){
        if(document.getElementById(kind+"scoreshield")===null){
          let frag = document.createElement("label");
          let node = document.createElement("label");
          node.id=kind+"scoreshield";
          frag.appendChild(document.createTextNode("備考欄"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"scoreshield").addEventListener("change",calculation);
        }
        if(kind==="def"){
          nowhp+=15*itemlv;
          healthpoint+=15*itemlv;
          btnnowhp.value = healthpoint;
          inputnowhp.max = healthpoint;
        }
      }
      function shellbell(i,kind,itemlv){
        if(document.getElementById(kind+"shellbell")===null){
          let frag = document.createElement("label");
          let node = document.createElement("label");
          node.id=kind+"shellbell";
          frag.appendChild(document.createTextNode("備考欄"));
          document.getElementsByName("itemli")[i].appendChild(frag);
          document.getElementsByName("itemli")[i].appendChild(node);
          document.getElementById(kind+"shellbell").addEventListener("change",calculation);
        }
        if(kind==="atk"){
          sp_attack+=1.6*Math.floor((itemlv+1)/2);
        }
      }
      //もちものをステータス計算に適応し、新しくインプットを作る
      function tadanoshori(i,kind){
        let item = items[i];
          let itemlv = items_level[i].value;
          switch(item){
            case "ちからのハチマキ":
              powerband(i,kind,itemlv);
            break;
            case "かるいし":
              floatstone(i,kind,itemlv);
            break;
            case "もうこうダンベル":
              dumbbell(i,kind,itemlv);
            break;
            case "するどいツメ":
              nail(i,kind,itemlv);
            break;
            case "じゃくてんほけん":
              insurance(i,kind,itemlv);
            break;
            case "しんげきメガネ":
              specs(i,kind,itemlv);
            break;
            case "ピントレンズ":
              scope(i,kind,itemlv);
            break;
            case "エオスビスケット":
              cookie(i,kind,itemlv);
            break;
            case "ものしりメガネ":
              wise(i,kind,itemlv);
            break;
            case "こだわりメガネ":
              choice(i,kind,itemlv);
            break;
            case "エナジーアンプ":
              energy(i,kind,itemlv);
            break;
            case "とつげきチョッキ":
              vest(i,kind,itemlv);
            break;
            case "おたすけバリア":
              barrier(i,kind,itemlv);
            break;
            case "がくしゅうそうち":
              share(i,kind,itemlv);
            break;
            case "きあいのハチマキ":
              focusband(i,kind,itemlv);
            break;
            case "たべのこし":
              leftovers(i,kind,itemlv);
            break;
            case "ゴツゴツメット":
              helmet(i,kind,itemlv);
            break;
            case "ゴールサポーター":
              scoreshield(i,kind,itemlv);
            break;
            case "かいがらのすず":
              shellbell(i,kind,itemlv);
            break;
          }
      }
      function itemprocess(){
        for(let i = 0;i<=2;i++){
          tadanoshori(i,"atk")
        }
        for(let i = 3;i<=5;i++){
          tadanoshori(i,"def");
        }
        if([items[0],items[1],items[2]].includes("じゃくてんほけん")){
          let itemlv=items_level[items.indexOf("じゃくてんほけん")].value-0;
          attack+=Math.floor((document.getElementById("atkinsurance").value*[2,2.5,3,3][Math.floor(itemlv/10)]*attack)/100);
      }
      if([items[0],items[1],items[2]].includes("ものしりメガネ")){
          let itemlv=items_level[items.indexOf("ものしりメガネ")].value-0;
          sp_attack+=Math.floor(([3,5,7,7][Math.floor(itemlv/10)]*sp_attack)/100);
        }
      }
      //スキルのdatalistを変更する
      function changeskills(){
        attackpokemon = extract(data,inputattackpokemon.value,data.length);
        inputskill.value="通常攻撃";
        let datali = document.getElementById("skills");
        while(datali.firstChild){
          datali.removeChild(datali.firstChild);
        }
        let frag = "";
        for(let i = 0;i<=attackpokemon.skills.length;i++){
          frag = document.createElement("option");
          frag.value = attackpokemon.skills[i].name;
          frag.appendChild(document.createTextNode(attackpokemon.skills[i].name))
          datali.appendChild(frag);
        }
      }
      //チェックボックスを作成する
      function createnode(){
       if(attackpokemon.name ==="ルカリオ"&&!(["しんそく","しんそく+","フルチャージグロウパンチ","チャージなしグロウパンチ","でんこうせっか","コメットパンチ"].includes(skill.name))&&document.getElementById("lucario_extremespeedbuff")===null&&attacklevel>=11){
          let extremespeedbuff = document.createElement("input");
          let label = document.createElement("label");
          extremespeedbuff.type = "checkbox";
          extremespeedbuff.id = "lucario_extremespeedbuff";
          label.className="check";
          label.id ="lucario_extremespeedlabel";
          label.appendChild(document.createTextNode("神速+のバフを有効にする"));
          label.appendChild(extremespeedbuff);
          document.getElementById("checks").appendChild(label);
          lucario_extremespeedbuff = true;
          extremespeedbuff_check = document.getElementById("lucario_extremespeedbuff");
          extremespeedbuff_check.addEventListener("change",calculation);
        }else if(((attackpokemon.name!=="ルカリオ"||(["しんそく","しんそく+","フルチャージグロウパンチ","チャージなしグロウパンチ","でんこうせっか","コメットパンチ"].includes(skill.name))||attacklevel<11))&&document.getElementById("lucario_extremespeedbuff")!==null){
           lucario_extremespeedbuff = false;
           document.getElementById("lucario_extremespeedbuff").remove();
           document.getElementById("lucario_extremespeedlabel").remove();
           extremespeedbuff_check = null;
        }
      }
      //もちものをダメージ計算に適用する
      function itemtreatment(){
        for(let i = 0;i<=2;i++){
          let item = items[i];
          let itemlv = items_level[i].value;
          switch(item){
            case "ちからのハチマキ":
              if((skill.name.includes("通常攻撃")||skill.name.includes("強化攻撃"))&&document.getElementById("atkpowerband").checked){
                let valll = Math.floor([1,2,3,3][Math.floor(itemlv/10)]*(nowhp-damage)/100);
                let nummm = kind==="attack"?600/(defence+600)*valll:600/(sp_defence+600)*valll;
                console.log(valll);
                console.log(nummm);
                if(nummm>360){
                  damage+=nummm
                }else{
                damage=Math.floor(damage+nummm);
                }
              }
            break;
            case "するどいツメ":
              if((skill.name.includes("通常攻撃")||skill.name.includes("強化攻撃"))&&document.getElementById("atknail").checked){
                damage+=[10,15,20,20][Math.floor(itemlv/10)];
                damage+=Math.floor([40,45,50,50][Math.floor(itemlv/10)]*attack/100)
              }
            break;
            case "エナジーアンプ":
              if(document.getElementById("atkenergy").checked){
                damage+=Math.floor(damage*[7,14,21,21][Math.floor(itemlv/10)]/100)
              }
          }
        }
        
          if(inputcritical.checked){
            if([items[0],items[1],items[2]].includes("ピントレンズ")){
              let itemlv=items_level[items.indexOf("ピントレンズ")].value-0;
              if(attackpokemon.name==="マリルリ"){
                damage=Math.floor(damage*(1.5+0.008*Math.floor(itemlv/2)));
                damage+=Math.floor([45,60,75,75][Math.floor(itemlv/10)]*attack/100);
              }else{
                damage=Math.floor(damage*(2+0.008*Math.floor(itemlv/2)));
                damage+=Math.floor([45,60,75,75][Math.floor(itemlv/10)]*attack/100);
              }
            }else{
              if(attackpokemon.name==="マリルリ"){
                damage=Math.floor(damage*1.5);
              }else{
                damage=Math.floor(damage*2);
              }
            }
          }
      }
      function calculation(){
        let inputs = document.getElementsByTagName("input");
        for(let i = 1;i<inputs.length;i++){
          let inputone = inputs[i];
          if(inputone.type==="number" && inputone.value-0>inputone.max){
            inputone.value=inputone.max;
          }
        }
        attackpokemon = extract(data,inputattackpokemon.value,data.length);
        skill = extract(attackpokemon.skills,inputskill.value,attackpokemon.skills.length);
        attacklevel = inputattacklevel.value - 0;
        attack = attackpokemon.attack[attacklevel-1];
        sp_attack = attackpokemon.sp_attack[attacklevel-1];
        defencepokemon = extract(data,inputdefencepokemon.value,data.length);
        defencelevel = inputdefencelevel.value;
        healthpoint = defencepokemon.hp[defencelevel-1];
        defence = defencepokemon.defence[defencelevel-1];
        sp_defence = defencepokemon.sp_defence[defencelevel-1];
        inputnowhp.max = healthpoint;
        btnnowhp.value = healthpoint;
        nowhp = inputnowhp.value;
        items = [inputitems[0].value,inputitems[1].value,inputitems[2].value,inputitems[3].value,inputitems[4].value,inputitems[5].value];
        if(attackpokemon.kind ==="attack"||(skill.name==="通常攻撃")){
          kind = "attack";
        }else{
          kind = "special";
        }
        createnode();
        itemprocess();
        if(inputnowhp.value>healthpoint){
          inputnowhp.value = healthpoint;
        }
        if((items[0]===items[1]&&items[0]!=="")||(items[1]===items[2]&&items[1]!=="")||(items[2]===items[0]&&items[0]!=="")){
          document.getElementById("warning").textContent="重複するもちものがあります";
        }else{
          document.getElementById("warning").textContent="";
        }
        if((items[3]===items[4]&&items[3]!=="")||(items[4]===items[5]&&items[4]!=="")||(items[5]===items[3]&&items[3]!=="")){
          document.getElementById("warning2").textContent="重複するもちものがあります";
        }else{
          document.getElementById("warning2").textContent="";
        }
        atk.textContent = `${kind==="attack"?"こうげき":"とくこう"}:${kind==="attack"?attack:sp_attack}`;
        def.textContent = `${kind==="attack"?"ぼうぎょ":"とくぼう"}:${kind==="attack"?defence:sp_defence}`;
        maxhp.textContent = `最大HP:${healthpoint}`
        damage=kind==="attack"?Math.floor(skill.ratio*0.01*attack+skill.per*(attacklevel-1)+skill.base):Math.floor(skill.ratio*0.01*sp_attack+skill.per*(attacklevel-1)+skill.base);
        if(skill.name === "しんそく+"||(lucario_extremespeedbuff&&document.getElementById("lucario_extremespeedbuff").checked)){
          damage=Math.floor(damage*1.075);
        }
        console.log(items);
        console.log([items[0],items[1],items[2]].includes("ちからのハチマキ"));
        if(defencepokemon.name==="みがわり人形"){
          if(skill.rate[0]===0&&skill.decrease[0]===0&&skill.current[0]===0&&![items[0],items[1],items[2]].includes("ちからのハチマキ")){
            itemtreatment();
            result.textContent = damage;
          }else{
            if([items[0],items[1],items[2]].includes("ちからのハチマキ")){
            items.splice(items.indexOf("ちからのハチマキ"),1,"")
          }
            itemtreatment();
            result.textContent =`${damage}ダメージ+割合`;
          }
        }else{
        damage =kind==="attack"?600/(defence+600)*damage:600/(sp_defence+600)*damage;
        damage = Math.floor(damage);
        console.log(damage);
        damage+=healthpoint*skill.rate[0]/100<skill.rate[1]?Math.floor(healthpoint*skill.rate[0]/100):skill.rate[1];
        damage+=skill.decrease[0]*(healthpoint-nowhp)/100<skill.decrease[1]?Math.floor(skill.decrease[0]*(healthpoint-nowhp)/100):skill.decrease[1];
        damage+=Math.floor(skill.current[0]*nowhp/100<skill.current[1]?Math.floor(skill.current[0]*nowhp/100):skill.current[1]);
        console.log(damage);
        itemtreatment();
        console.log(damage);
        result.textContent = `${damage}ダメージ`;
        }
      };
      calculation();
      let itemremove = (i)=>{
        let removing = document.getElementsByName("itemli")[i];
        if(removing.getElementsByTagName("label")[1]!==undefined){
          removing.removeChild(removing.lastChild);
          removing.removeChild(removing.lastChild);
        }
      }
      /*/ここからイベント設定/*/
      inputattackpokemon.addEventListener("change",function(){
        changeskills();
        calculation();
      });
      inputattackpokemon.addEventListener("change",calculation);
      inputattacklevel.addEventListener("change",calculation);
      inputskill.addEventListener("change",calculation);
      inputdefencepokemon.addEventListener("change",calculation);
      inputdefencelevel.addEventListener("change",calculation);
      inputitems[0].addEventListener("change",()=>{
        itemremove(0);
        calculation();
      });
      inputitems[1].addEventListener("change",()=>{
        itemremove(1);
        calculation();
      });
      inputitems[2].addEventListener("change",()=>{
        itemremove(2);
        calculation();
      });
      inputitems[3].addEventListener("change",()=>{
        itemremove(3);
        calculation();
      });
      inputitems[4].addEventListener("change",()=>{
        itemremove(4);
        calculation();
      });
      inputitems[5].addEventListener("change",()=>{
        itemremove(5);
        calculation();
      });
      inputitems_level[0].addEventListener("change",calculation);
      inputitems_level[1].addEventListener("change",calculation);
      inputitems_level[2].addEventListener("change",calculation);
      inputitems_level[3].addEventListener("change",calculation);
      inputitems_level[4].addEventListener("change",calculation);
      inputitems_level[5].addEventListener("change",calculation);
      inputnowhp.addEventListener("change",calculation);
      btnnowhp.addEventListener("click",()=>{
        inputnowhp.value = healthpoint;
        calculation();
      });
      inputcritical.addEventListener("change",calculation);
      inputpluspower.addEventListener("change",calculation);
      document.addEventListener('touchstart', (event) => {
        if(event.touches && event.touches.length > 1) {
            event.preventDefault();
        }
      }, {
          passive: false
      });
      document.getElementById("atkpowerband").addEventListener("change",calculation);
      document.getElementById("atkdumbbell").addEventListener("change",calculation);
      document.getElementById("defpowerband").addEventListener("change",calculation);
      document.getElementById("defdumbbell").addEventListener("change",calculation);
    </script>
  </body>
</html>
